sudo: required
language: ruby
rvm: 2.4.0
os: linux
python:
  - "3.4"
services:
  - docker
cache:
  bundler: true
  directories: $TRAVIS_BUILD_DIR/tmp/.htmlproofer
addons:
  apt:
    packages:
    - libcurl4-openssl-dev
    - ca-certificates
before_install: 
    - gem update --system --no-doc
    - bundle install --gemfile=Gemfile
    - pip install --user pathlib
matrix:
  include:
    - env: build_docker=true
      script:
      - rake docker:build
      - if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then \"git commit -m 'Updates site count' ./_includes/count_support.html\" fi
      - if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then \"git push origin HEAD:master\" fi
    - env: NOKOGIRI_USE_SYSTEM_LIBRARIES=true
      script:
      - bundle exec rake verify_images
      - bundle exec rake proof_external
      allow_failures:
      - script: 
        - bundle exec rake proof_external
        - ./verify_images.rb
        - bundle exec rake verify_images